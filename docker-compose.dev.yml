version: "3"
services:
  web:
    container_name: sendy_web
    build:
      context: ./
      dockerfile: web.dockerfile
    volumes:
      - ./:/var/www
    ports:
      - "8083:80"
    links:
      - app
  app:
    container_name: sendy_app
    build:
      context: ./
      dockerfile: app-dev.dockerfile
      args:
        - USER=${USER}
        - UID=${UID}
    volumes:
      - ./:/var/www
      - ./custom.d:/usr/local/etc/php/custom.d
    environment:
      - "DB_HOST=pgsql"
      - "DB_PORT=5432"
      - "PHP_INI_SCAN_DIR=/usr/local/etc/php/custom.d:/usr/local/etc/php/conf.d"
    links:
      - pgsql
    depends_on:
      - pgsql
  nodejs:
    build:
      context: images/node
      args:
        - USER=${USER}
    container_name: sendy_nodejs
    volumes:
      - ./:/var/www/
  pgsql:
    image: postgres:latest
    container_name: sendy_psql
    environment:
      - "POSTGRES_DB=${DB_DATABASE}"
      - "POSTGRES_USER=${DB_USERNAME}"
      - "POSTGRES_PASSWORD=${DB_PASSWORD}"
    volumes:
      - ./data/db:/data/db
    ports:
      - "5432:5432"
